<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Filter App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="date"], input[type="text"], input[type="file"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .results-info {
            margin: 10px 0;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>CSV Data Filter</h1>
    
    <div class="container">
        <div class="filter-group">
            <label for="csvFile">Upload CSV File:</label>
            <input type="file" id="csvFile" accept=".csv">
        </div>
    </div>

    <div class="container hidden" id="filterSection">
        <h3>Filters</h3>
        <div class="filters">
            <div class="filter-group">
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate">
            </div>
            <div class="filter-group">
                <label for="endDate">End Date:</label>
                <input type="date" id="endDate">
            </div>
            <div class="filter-group">
                <label for="issueSearch">Search in Issues (Column 9):</label>
                <input type="text" id="issueSearch" placeholder="Type to search...">
            </div>
            <div class="filter-group">
                <label>&nbsp;</label>
                <button onclick="applyFilters()">Apply Filters</button>
            </div>
        </div>
    </div>

    <div class="container hidden" id="resultsSection">
        <div class="results-info" id="resultsInfo"></div>
        <div id="tableContainer"></div>
    </div>

    <script>
        let csvData = [];
        let headers = [];

        document.getElementById('csvFile').addEventListener('change', handleFileUpload);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            if (lines.length === 0) return;

            headers = lines[0].split(',').map(h => h.trim());
            csvData = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values.length >= 9) {
                    csvData.push(values);
                }
            }

            document.getElementById('filterSection').classList.remove('hidden');
            displayAllData();
        }

        function displayAllData() {
            displayResults(csvData);
        }

        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const searchText = document.getElementById('issueSearch').value.toLowerCase();

            let filteredData = csvData.filter(row => {
                const dateValue = row[0];
                const issueValue = row[8] ? row[8].toLowerCase() : '';

                let dateMatch = true;
                if (startDate && dateValue) {
                    dateMatch = dateValue >= startDate;
                }
                if (endDate && dateValue) {
                    dateMatch = dateMatch && dateValue <= endDate;
                }

                let textMatch = true;
                if (searchText) {
                    textMatch = issueValue.includes(searchText);
                }

                return dateMatch && textMatch;
            });

            displayResults(filteredData);
        }

        function displayResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsInfo = document.getElementById('resultsInfo');
            const tableContainer = document.getElementById('tableContainer');

            if (data.length === 0) {
                resultsInfo.textContent = 'No results found';
                tableContainer.innerHTML = '';
                resultsSection.classList.remove('hidden');
                return;
            }

            resultsInfo.textContent = `Found ${data.length} row(s)`;
            
            let tableHTML = '<table><thead><tr>';
            headers.forEach(header => {
                tableHTML += `<th>${header}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            data.forEach(row => {
                tableHTML += '<tr>';
                row.forEach(cell => {
                    tableHTML += `<td>${cell}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            resultsSection.classList.remove('hidden');
        }

        document.getElementById('issueSearch').addEventListener('input', applyFilters);
        document.getElementById('startDate').addEventListener('change', applyFilters);
        document.getElementById('endDate').addEventListener('change', applyFilters);
    </script>
</body>
</html>
